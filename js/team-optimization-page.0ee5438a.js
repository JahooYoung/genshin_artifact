"use strict";(self["webpackChunkgenshin_artifacts"]=self["webpackChunkgenshin_artifacts"]||[]).push([[121],{12961:function(t,e,s){s.r(e),s.d(e,{default:function(){return N}});var i=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[s("el-breadcrumb",[s("el-breadcrumb-item",[t._v("全队配装")])],1),s("el-divider"),s("el-drawer",{attrs:{title:"面板",visible:t.showAttributeDrawer},on:{"update:visible":function(e){t.showAttributeDrawer=e}}},[t.wasmAttribute?[s("div",{staticStyle:{padding:"0 20px"}},[s("attribute-panel",{attrs:{attribute:t.wasmAttribute}})],1)]:[s("el-empty",[t._v("In theory, in should not see this")])]],2),s("el-row",{attrs:{gutter:16}},[s("el-col",{ref:"content",staticClass:"mona-scroll",style:{height:t.contentHeight},attrs:{span:6}},[s("div",[s("my-button1",{attrs:{icon:"el-icon-caret-right",title:"开始计算"},on:{click:t.handleClickStart}}),s("my-button1",{attrs:{icon:"el-icon-plus",title:"添加成员"},on:{click:t.handleClickAddMember}})],1),t._l(t.presetNames,(function(e,i){return s("div",{key:i,staticClass:"member-item"},[s("div",{staticStyle:{display:"flex","justify-content":"space-between","align-items":"center"}},[s("p",{staticClass:"team-title"},[t._v("成员"+t._s(i+1))]),s("div",[s("el-button",{attrs:{circle:"",size:"mini",type:"text",icon:"el-icon-delete"},on:{click:function(e){return t.handleDeleteMember(i)}}})],1)]),s("p",{staticClass:"common-title2"},[t._v("计算预设")]),s("select-preset",{model:{value:t.presetNames[i],callback:function(e){t.$set(t.presetNames,i,e)},expression:"presetNames[index]"}}),s("p",{staticClass:"common-title2"},[t._v("权重")]),s("el-slider",{staticStyle:{"padding-left":"8px"},attrs:{min:0,max:1,step:.01,"show-input":!0},model:{value:t.weights[i],callback:function(e){t.$set(t.weights,i,e)},expression:"weights[index]"}}),i<t.presetNames.length-1?s("el-divider"):t._e()],1)}))],2),s("el-col",{staticClass:"mona-scroll",style:{height:t.contentHeight},attrs:{span:18}},[t.currentResultEntry?[s("el-input-number",{staticStyle:{"margin-bottom":"12px"},attrs:{value:t.resultIndex+1,min:1,max:t.results.length,size:"small"},on:{input:t.handleChangeResultIndex}}),t._l(t.currentResultEntry,(function(e,i){return s("div",{key:i,staticClass:"result-item"},[s("div",{staticClass:"result-item-top"},[s("div",[s("el-button",{attrs:{icon:"el-icon-s-data",circle:"",size:"mini",type:"text",title:"查看面板"},on:{click:function(e){return t.handleClickDisplayAttributePanel(i)}}})],1),s("div",{staticClass:"result-item-buttons"})]),s("div",{staticClass:"result-item-content"},t._l(t.currentResultEntry[i],(function(e){return s("artifact-display",{key:e,attrs:{item:t.artifactsById[e],buttons:!0,"lock-button":!0,"delete-button":!1,"edit-button":!1},on:{toggle:function(s){return t.handleToggleArtifact(e)}}})})),1)])}))]:[s("div",{staticStyle:{display:"flex","justify-content":"center"}},[s("el-empty")],1)]],2)],1)],1)},r=[],n=s(26294),a=s(65735),l=s(44368);function c(t,e){const i=new Worker(new URL(s.p+s.u(677),s.b));return new Promise(((s,r)=>{i.onmessage=function(r){const n=r.data.type;if("ready"===n)i.postMessage({input:t,artifacts:e});else if("result"===n){const t=r.data.data.result;i.terminate(),s(t)}},i.onerror=function(t){r(t)}}))}var u=s(39285),o=(s(42246),s(67828)),h=s(63655),m=s(16746),p=s(77921),d=s(24044),f=s(89415),g=s(98806),b=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("el-select",{attrs:{size:"small",value:t.value},on:{input:function(e){return t.$emit("input",e)}}},t._l(t.list,(function(t){return s("el-option",{key:t,attrs:{label:t,value:t}})})),1)},y=[],v={name:"SelectPreset",props:["value"],computed:{...(0,n.mapGetters)("presets",["allFlat"]),list(){let t=[];for(let e of this.allFlat)t.push(e.name);return t}}},w=v,k=s(1001),x=(0,k.Z)(w,b,y,!1,null,"0cfb48b7",null),I=x.exports,A=s(96581),C={name:"TeamOptimizationPage",components:{SelectCharacter:h.Z,SelectWeapon:m.Z,ItemConfig:p.Z,ArtifactDisplay:d.Z,MyButton1:f.Z,PresetItem:g.Z,SelectPreset:I,AttributePanel:A.Z},data(){return{results:[],resultIndex:0,contentHeight:"",presetNames:[null],weights:[],showAttributeDrawer:!1,wasmAttribute:null}},mounted(){const t=this.$refs["content"];this.$nextTick((()=>{const e=t.$el.getBoundingClientRect();this.contentHeight=`calc(100vh - ${e.top}px)`}))},methods:{handleClickAddMember(){8!==this.presetNames.length?(this.presetNames.push(null),this.weights.push(0)):this.$message.error("最多支持8个成员")},handleDeleteMember(t){1!==this.presetNames.length&&(this.$delete(this.presetNames,t),this.$delete(this.weights,t))},handleClickStart(){const t=this.presets.length===this.presetNames.length;if(!t)return void this.$message.error("请选择计算预设");const e=this.optimizeTeamWasmInterface,s=this.filteredArtifactsWasm,i=this.$loading({lock:!0,text:"莫娜占卜中（可能需要数分钟）"});c(e,s).then((t=>{this.results=t.artifacts,this.resultIndex=0})).catch((t=>{console.log(t)})).finally((()=>{i.close()}))},handleChangeResultIndex(t){this.resultIndex=t-1},handleClickDisplayAttributePanel:async function(t){const e=this.wasmGetAttributeInterface(t),s=await(0,l.le)(e);this.wasmAttribute=s,this.showAttributeDrawer=!0},wasmGetAttributeInterface(t){let e=[];if(this.currentResultEntry){const s=Object.values(this.currentResultEntry[t]),i=s.map((t=>this.artifactsById[t])).filter((t=>t));e=i.map((t=>(0,a.Lz)(t)))}return{character:this.presets[t].item.character,weapon:this.presets[t].item.weapon,buffs:this.presets[t].item.buffs,artifacts:e}},handleClickSaveAsKumi(t){let e=[];if(this.currentResultEntry){const s=Object.values(this.currentResultEntry[t]);e=s.map((t=>this.artifactsById[t])).filter((t=>t))}},handleToggleArtifact(t){(0,o.kY)(t)}},computed:{...(0,n.mapGetters)("artifacts",{artifactsFlat:"allFlat",artifactsById:"artifactsById"}),singleInterfaces(){return this.presets.map((t=>(0,u.DR)(t.item)))},currentResultEntry(){return 0===this.results.length?null:this.results[this.resultIndex]},filteredArtifacts(){let t=[];for(let e of this.artifactsFlat)e.level>=16&&t.push(e);return t.filter((t=>!t.omit))},filteredArtifactsWasm(){return this.filteredArtifacts.map(a.Lz)},presets(){let t=[];for(let e of this.presetNames)e&&t.push((0,u.kE)(e));return t},optimizeTeamHyperParamInterface(){return{mva_step:5,work_space:1e3,max_re_optimize:5,max_search:1e6,count:1e3}},optimizeTeamWasmInterface(){let t=[];for(let i=0;i<this.singleInterfaces.length;i++)t.push([this.singleInterfaces[i],this.weights[i]]);t.sort(((t,e)=>e[1]-t[1]));const e=t.map((t=>t[0])),s=t.map((t=>t[1]));return{single_interfaces:e,weights:s,hyper_param:this.optimizeTeamHyperParamInterface}}},watch:{"$store.state.accounts.currentAccountId"(){this.results=[],this.resultIndex=0,this.presetNames=[null],this.weights=[]}}},_=C,$=(0,k.Z)(_,i,r,!1,null,"603b4cec",null),N=$.exports}}]);